<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Matrix矩阵 · Shell's Blog</title><meta name="description" content="Matrix矩阵 - shell"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Shell's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="https://github.com/shellljx" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="http://weibo.com/licrafter" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Matrix矩阵</h1><div class="post-info">Jun 9, 2017</div><div class="post-content"><h4 id="什么是矩阵-矩阵的乘法代表什么"><a href="#什么是矩阵-矩阵的乘法代表什么" class="headerlink" title="什么是矩阵? 矩阵的乘法代表什么?"></a>什么是矩阵? 矩阵的乘法代表什么?</h4><p>由于大学时 &lt;&lt;线性代数&gt;&gt; 没怎么学好导致对于 android 中矩阵这块知识点一直非常的恐惧不敢去触碰。其实对矩阵感到恐惧根本原因还是因为不知道矩阵到底代表着什么意思，只记得以前学到的矩阵晦涩难懂的算术运算，但是完全不懂为什么要这么算。本着长痛不如短痛的想法，就来好好的研究一番，解惑。</p>
<a id="more"></a>
<p>要了解矩阵在 android 的应用首先要掌握什么是矩阵？矩阵的乘法运算代表什么意思？读了 </p>
<p><a href="https://nolaymanleftbehind.wordpress.com/2011/07/10/linear-algebra-what-matrices-actually-are/" target="_blank" rel="external">Linear Algebra: What matrices actually are</a> </p>
<p><a href="https://guangchun.wordpress.com/2011/10/12/affineandhomogeneous/" target="_blank" rel="external">仿射变换与齐次坐标</a></p>
<p>[<a href="https://math.stackexchange.com/questions/271927/why-historically-do-we-multiply-matrices-as-we-do" target="_blank" rel="external">Why, historically, do we multiply matrices as we do?</a></p>
<p>这两篇文章让我对矩阵有了基本的理解，<strong>矩阵其实代表了线性方程式，每一个线性方程式都有一个对应的矩阵，矩阵的乘法是一种直观的形式来替换向量空间中的线性变换过程</strong>。</p>
<p>如果有方程式组 x’ = ax + by 和 y’ = cx + dy ，x″ = a′x′ + b′y′ 和 y″ = c′x′ + d′y′ 然后我们可以把第一对公式插入第二对公式，把  x″ 和 y″ 表示成 x 和 y 的形式：</p>
<p><img src="http://7vzpfd.com1.z0.glb.clouddn.com/E49174E7-B6CF-4671-BA89-5493C9CF1C59.png" alt=""></p>
<p>和</p>
<p><img src="http://7vzpfd.com1.z0.glb.clouddn.com/9C6C6FFF-FCC9-4F12-8BC2-CEB938269753.png" alt=""></p>
<p>写这些变量会比较得啰嗦，所以我们用一个阵列来表示，第一行是 x′ 和 x″ ，第二行是 y′ 和 y″ 上面两个线性变变换就可以用下面的矩阵乘法表示：</p>
<p><img src="http://7vzpfd.com1.z0.glb.clouddn.com/D0E32D73-D382-4CCE-BAF0-54A0473A895A.png" alt=""></p>
<p>所以矩阵乘法是一种线性替换的记录器，那在计算机图形学里面点 (x,y) 做线性变换到点 (x”,y”) 的变换过程也就可以用矩阵来表示了。</p>
<p>假设P = (x,y) 是二维空间中的点，T 是一线性变换，那么存在一个矩阵A，使得P’ = (x’ , y’) = T(p) 下面的旋转变换R，以及缩放S变换都有相应的变换矩阵:</p>
<p><img src="http://7vzpfd.com1.z0.glb.clouddn.com/25D8F4D0-B457-481E-A85E-2B8A41DC4441.png" alt=""></p>
<p>根据矩阵的乘法可以换算出方程式组正好可以解除变换后的点的坐标 (x’,y’)。</p>
<p>关于齐次坐标系以及为什么二维的矩阵是 3x3 上面几篇文章已经讲得很清楚了，就不再多说了。那在齐次坐标系中表示旋转，缩放和平移线性变换的矩阵如下：</p>
<p><img src="http://7vzpfd.com1.z0.glb.clouddn.com/76B0D327-7AB6-4E62-B3FF-75AEFB62672E.png" alt=""></p>
<h4 id="Android中的矩阵"><a href="#Android中的矩阵" class="headerlink" title="Android中的矩阵"></a>Android中的矩阵</h4><p>由齐次坐标系中各种线性变换的矩阵可分析出<code>MSCALE_X</code>、<code>MSCALE_Y</code> 对缩放起作用，<code>MSKEW_X</code> 和 <code>MSKEW_Y</code> 对错切起作用，<code>MTRANS_X</code> 和 <code>MTRANS_Y</code> 对平移起作用，剩下的三个官方文档也没详细解释就忽略。<code>MSCALE_X</code>、<code>MSCALE_Y</code>、<code>MSKEW_X</code> 和 <code>MSKEW_Y</code> 这四个对旋转起作用。<br><img src="http://7vzpfd.com1.z0.glb.clouddn.com/5B6473BD-8012-4B50-AC57-31AAA232D94A.png" alt=""><br>在 Android 中初始矩阵为:<br><img src="http://7vzpfd.com1.z0.glb.clouddn.com/9DA4C313-9E58-43F7-B3D2-E66F2B7101E8.png" alt=""></p>
<h4 id="矩阵API各方法执行顺序"><a href="#矩阵API各方法执行顺序" class="headerlink" title="矩阵API各方法执行顺序"></a>矩阵API各方法执行顺序</h4><p>android 中对矩阵的相关数学操作都被系统封装的很好，然后暴露出 <a href="https://developer.android.com/reference/android/graphics/Matrix.html#postRotate(float, float, float" target="_blank" rel="external">postRotate</a>)，<a href="https://developer.android.com/reference/android/graphics/Matrix.html#postScale(float, float, float, float" target="_blank" rel="external">postScale</a>)，<a href="https://developer.android.com/reference/android/graphics/Matrix.html#preRotate(float" target="_blank" rel="external">preRotate</a>) 等方法。<code>post</code> 开头的方法表示在矩阵乘法队列末尾添加一个矩阵，<code>pre</code> 开头的方法表示是在矩阵乘法队列的开头添加一个矩阵，<code>set</code> 开头的方法表示清空矩阵队列并设置新的矩阵。然后从头开始执行矩阵乘法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MatrixAnimation</span> <span class="keyword">extends</span> <span class="title">Animation</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mWidth, mHeight;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height, <span class="keyword">int</span> parentWidth, <span class="keyword">int</span> parentHeight)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.initialize(width, height, parentWidth, parentHeight);</div><div class="line">        <span class="keyword">this</span>.mWidth = width;</div><div class="line">        <span class="keyword">this</span>.mHeight = height;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">applyTransformation</span><span class="params">(<span class="keyword">float</span> interpolatedTime, Transformation t)</span> </span>&#123;</div><div class="line">        Matrix matrix = t.getMatrix();</div><div class="line">        matrix.preRotate(interpolatedTime * <span class="number">360</span>);<span class="comment">//旋转</span></div><div class="line"></div><div class="line">        matrix.preTranslate(-mWidth / <span class="number">2</span>, -mHeight / <span class="number">2</span>);</div><div class="line">        matrix.postTranslate(mWidth / <span class="number">2</span>, mHeight / <span class="number">2</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其实补间动画的原理就是 Matrix 变换，自定义个补间动画让 Button 围绕着中心选择这要这么实现呢？</p>
<p>首先选择要用到 <code>Rotate()</code> 方法，那么选择的中心点在哪呢？其实除了 <code>translate()</code> 变换，其余的变换如果不指定中心点的话就以 View 的 (0,0) 点作为中心点，所以要先 <code>preTranslate(-mWidth / 2, -mHeight / 2)</code> 做平移变换让绘制中心在(0,0)点然后再旋转，再 <code>postTranslate(mWidth / 2, mHeight / 2)</code> 平移回来。所以上面的执行顺序为 <code>matrix.preTranslate(-mWidth / 2, -mHeight / 2)</code>-&gt;<code>preRotate(interpolatedTime * 360)</code>-&gt;<code>matrix.postTranslate(mWidth / 2, mHeight / 2)</code>。</p>
<p><img src="http://7vzpfd.com1.z0.glb.clouddn.com/47F44C76-BF70-47DD-9251-78560A801A51.png" alt=""></p>
<p><img src="http://7vzpfd.com1.z0.glb.clouddn.com/matrix.gif" alt=""></p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/06/03/Fragment那点事⑤保存与恢复实践/" class="prev">上一篇</a><a href="/2017/06/18/反人类音量滑块/" class="next">下一篇</a></div><div data-thread-key="2017/06/09/Matrix矩阵/" data-title="Matrix矩阵" data-url="http://yoursite.com/2017/06/09/Matrix矩阵/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"[object Object]"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2015 - 2017 <a href="http://yoursite.com">shell</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>